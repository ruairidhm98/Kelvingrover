var fn_addin=function(o,l,e){var a=a||{};return a.styles=a.styles||{},a.commands=a.commands||{},a.dependencies=e||a.dependencies||{},a.styles.style=function(){},a.views=a.views||{},a.collect=a.collect||{},a.models=a.models||{},a.templates=a.templates||{},a.info={id:"links_common",class:"links",appClass:"links-app",region:"top-left",order:"prepend",width:240,height:75,addin:"3b23bf88-bde9-40df-bfca-bf20add886c9",toggleEvent:"globalEvent:key:L",closeOnEsc:"true",visibleSetting:"linksVisible"},o.console.log(o.elapsed()+": "+a.info.id+" started"),a.templates=a.templates||{},a.templates["quicklinks-item-template"]=Handlebars.template({1:function(e,t,i,n){return' class="local"'},3:function(e,t,i,n){var s;return'<img src="'+this.escapeExpression("function"==typeof(s=null!=(s=t.favicon_url||(null!=e?e.favicon_url:e))?s:t.helperMissing)?s.call(e,{name:"favicon_url",hash:{},data:n}):s)+'">'},5:function(e,t,i,n){var s;return" "+(null!=(s=t.unless.call(e,null!=e?e.team:e,{name:"unless",hash:{},fn:this.program(6,n,0),inverse:this.noop,data:n}))?s:"")},6:function(e,t,i,n){return'<span class="link-icon-placeholder">&nbsp;</span>'},8:function(e,t,i,n){return'<div class="icon-wrapper destroy"><i draggable="false" class="icon">✕</i></div>'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,i,n){var s,a,o=t.helperMissing,l="function",r=this.escapeExpression;return'<div draggable="true" class="link-wrapper '+r(typeof(a=null!=(a=t.classes||(null!=e?e.classes:e))?a:o)===l?a.call(e,{name:"classes",hash:{},data:n}):a)+'">\n\t<a draggable="false" href="'+r(typeof(a=null!=(a=t.url||(null!=e?e.url:e))?a:o)===l?a.call(e,{name:"url",hash:{},data:n}):a)+'"'+(null!=(s=t.if.call(e,null!=e?e.local:e,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?s:"")+">"+(null!=(s=t.if.call(e,null!=e?e.favicon_url:e,{name:"if",hash:{},fn:this.program(3,n,0),inverse:this.program(5,n,0),data:n}))?s:"")+' <span class="link-text">'+r(typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:o)===l?a.call(e,{name:"title",hash:{},data:n}):a)+"</span></a>\n\t"+(null!=(s=t.unless.call(e,null!=e?e.readOnly:e,{name:"unless",hash:{},fn:this.program(8,n,0),inverse:this.noop,data:n}))?s:"")+"\n</div>\n"},useData:!0}),a.templates.quicklinks=Handlebars.template({1:function(e,t,i,n){return'\t\t<li data-momo-id="chromeTab" data-place="links" class="optional-link"><a href="chrome-search://local-ntp/local-ntp.html" class="local"><svg class="icon-svg icon-chrome-tab" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 497.401 497.401"><g><path d="M478.742 154.382H320.714c28.366 21.765 47.111 55.717 47.111 94.307 0 30.63-14.345 56.386-30.933 79.445-28.322 39.41-95.817 168.878-95.817 168.878 2.567.043 5.026.388 7.636.388 137.341 0 248.69-111.348 248.69-248.69-.022-33.412-6.709-65.229-18.659-94.328z"/><path d="M248.172 129.619c54.402-.388 217.628-2.049 217.628-2.049C423.24 51.511 342.069 0 248.69 0 170.819 0 101.361 35.829 55.782 91.848l75.972 134.925c10.268-55.113 58.349-96.744 116.418-97.154z"/><path d="M248.668 367.825c-51.964 0-91.568-35.117-111.974-79.855-20.535-45.018-98.061-171.984-98.061-171.984C14.301 154.425 0 199.832 0 248.69c0 124.744 91.935 227.744 211.696 245.648l77.288-134.019c-12.641 4.615-26.101 7.506-40.316 7.506z"/><circle cx="248.668" cy="248.711" r="80.416"/></g></svg> Chrome Tab</a></li>\n\t\t<li data-momo-id="apps" class="optional-link" data-place="links"><a href="chrome://apps" id="app-return" class="local"><svg class="icon-svg icon-apps" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M3 3h6v6H3V3zm10 0h6v6h-6V3zm10 0h6v6h-6V3zM3 13h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6zM3 23h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6z"/></svg> Apps</a></li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,i,n){var s,a;return'<div class="message"><i class="loading-icon"></i><span class="loading-label">Loading...</span></div>\n<ol class="links-list" style="max-height:'+this.escapeExpression("function"==typeof(a=null!=(a=t.maxHeight||(null!=e?e.maxHeight:e))?a:t.helperMissing)?a.call(e,{name:"maxHeight",hash:{},data:n}):a)+'px">\n'+(null!=(s=t.if.call(e,null!=e?e.isChrome:e,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?s:"")+'</ol>\n<div class="empty">\n\t<div class="title">No links yet</div>\n\t<div class="description">Add your favorite links</div>\n\t<span class="button new-toggle empty-toggle">New Link</span>\n</div>\n<div class="footer-input new">\n\t<div class="icon-wrapper new-hide"><i class="icon">✕</i></div>\n\t<input type="text" id="new-title" class="new-title new-toggle" placeholder="New Link">\n\t<input type="text" id="new-url" class="new-url" placeholder="URL">\n</div>\n'},useData:!0}),a.templates.teamlinks=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,i,n){var s,a=t.helperMissing,o="function",l=this.escapeExpression;return'<div class="app-dash" >\n\t<div class="team-menu-toggle add-shadow" href="">\n\t\t<img class="team-logo" src="'+l(typeof(s=null!=(s=t.logo||(null!=e?e.logo:e))?s:a)===o?s.call(e,{name:"logo",hash:{},data:n}):s)+'">\n\t\t<div class="app dropdown dash-dropdown nipple-top-left team-dropdown">\n\t\t\t<ul class="dropdown-list">\n\t\t\t\t<li class="settings"><a href="https://team.momentumdash.com/">Team Settings</a></li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n\t<div class="team-dash-links-wrapper">\n\t\t<ol class="team-dash-links add-shadow"></ol>\n\t\t<span class="more-links">More<i class="icon icon-angle-down"></i></span>\n\t</div>\n</div>\n\n<div class="app-wrapper nipple-top-left">\n\t<div class="app links-app">\n\t\t<ol style="max-height:'+l(typeof(s=null!=(s=t.maxHeight||(null!=e?e.maxHeight:e))?s:a)===o?s.call(e,{name:"maxHeight",hash:{},data:n}):s)+'px"></ol>\n\t\t<div class="add-error-message message">Connection required to add link. <span class="message-action retry-add">Retry</span></div>\n\t\t<div class="message-empty"><i class="loading-icon"></i>Loading...</div>\n\t\t<div class="footer-input new">\n\t\t\t<div class="icon-wrapper new-hide"><i class="icon">✕</i></div>\n\t\t\t<input type="text" id="new-title" class="new-title new-toggle" placeholder="New Link">\n\t\t\t<input type="text" id="new-url" class="new-url" placeholder="URL">\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),a.styles=a.styles||{},a.styles.style=function(){var e=document.createElement("style");e.type="text/css",e.innerHTML=".links-wrapper{position:absolute;top:100%;left:7px;display:none}.links-app{padding:0;min-width:200px;overflow-y:hidden;transition-property:opacity,height}.links .links-list{overflow-y:auto}.links li{position:relative}.links li .link-wrapper{display:flex;justify-content:space-between}.links li a{min-width:125px;max-width:300px;padding:5px 10px 5px var(--app-padding);display:inline-block;flex:1 0 auto;cursor:pointer;font-size:15px;line-height:100%;opacity:.75;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.light .app .links li a{opacity:.8}.links li a:hover{opacity:1}.links .first-link .icon-wrapper,.links .first-link a{padding-top:calc(var(--app-padding) - 1px)}.links.show-message .first-link a{margin-top:-20px}.links .first-link .destroy{top:auto;bottom:2px}.links .icon-wrapper{opacity:0}.links .link-wrapper .icon-wrapper{padding-right:calc(var(--app-padding) - 1px);opacity:0}.links .icon{margin-top:-1px;font-size:11px;opacity:.4}.links li:hover .icon-wrapper{opacity:1}.links .icon-wrapper:hover .icon{opacity:.8}.links .icon-wrapper:active .icon,.links .new.open .icon-wrapper{opacity:1}.Firefox .links .destroy,.Firefox .links-new-hide{font-size:15px}.links .new{display:none}.links .new input{padding-top:4px;padding-left:calc(var(--app-padding) - 3px);padding-right:var(--padding-right);cursor:pointer}.links .open.new>.new-title{padding-bottom:2px!important;display:block;text-align:left}.links .new .icon-wrapper{position:absolute;right:14px;z-index:10;top:2px}.links .new-url{padding-top:3px!important;display:none}.links .open>.new-url{display:block}.links.is-empty .footer-input{position:absolute;right:0;bottom:0;left:0}.links.is-empty .footer-input .new-title{display:none}.links.is-empty .new.open .new-title{display:block}.links .message{margin:15px 0;display:none}.links.show-message .message{display:block}.team-dash-links li .icon-wrapper,.teamlinks li a img{display:none}.links.show-message .empty{margin-top:-25px}.teamlinks .app-dash{padding-left:0!important}.teamlinks .team-menu-toggle{padding:0 10px 10px 20px;cursor:pointer}.teamlinks .team-menu-toggle.add-shadow:before{top:5px;right:5px;left:10px}.teamlinks .team-logo{height:auto;width:auto;max-height:70px;max-width:120px;padding-top:14px;position:relative;z-index:1}.teamlinks .team-dropdown{margin-top:15px;position:absolute;left:33px;z-index:3;transform:translateY(-5px);opacity:0;transition:transform .25s ease,height .25s ease,opacity .25s ease}.teamlinks.active-fade-in .team-dropdown{transform:none;opacity:1}.teamlinks .dropdown li{padding:0}.teamlinks .dropdown li a{padding:6px 14px 5px;opacity:1}.team-dash-links-wrapper{--left-padding:calc(var(--app-padding) + 2px);position:absolute;top:100%}.team-dash-links li a{padding-top:6px;padding-bottom:5px;padding-left:var(--left-padding);color:#fff;font-size:1rem;font-weight:500;opacity:.85}.show .team-dash-links li:hover .icon-wrapper,.team-dash-links li a:hover{opacity:1}.team-dash-links .first-link .icon-wrapper,.team-dash-links .first-link a{padding-top:12px}.teamlinks .app li a{padding:6px calc(var(--app-padding) - 3px)}.teamlinks .app li:first-child .icon-wrapper,.teamlinks .app li:first-child a{padding-top:calc(var(--app-padding) - 3px)}.teamlinks .more-links{width:125px;padding:6px 38px;padding-left:var(--left-padding);display:block;opacity:0;cursor:pointer;font-size:.75rem;font-weight:500;line-height:100%;text-transform:uppercase;transition:var(--a-default);transition-duration:.1s}.team-dash-links-wrapper:hover .more-links,.top-left:hover .team-links .more-links{opacity:.6}.teamlinks .more-links:hover{opacity:.8!important}.teamlinks.show-fade-in .more-links{opacity:.6!important}.teamlinks .more-links .icon{margin-left:2px;opacity:1;font-size:.8125rem}.teamlinks .no-extra .footer-input .new-hide{top:16px}.teamlinks .no-extra .footer-input .new-title{padding-top:16px}.team-dropdown li:first-child a{padding-top:9px!important}",document.getElementsByTagName("head")[0].appendChild(e)},a.models.QuickLinks=Backbone.Model.extend({defaults:function(){return{title:"New Link",url:"",local:!1,order:0}},initialize:function(e){e=e||{},this.idAttribute=this.collection.idAttribute||"csid",this.serverIdAttribute=this.collection.serverIdAttribute||"id",Backbone.Model.prototype.initialize.call(this,e)},saveOptions:function(){return this.collection.saveOptions},saveNewOrder:function(e){this.save({order:e},this.saveOptions())},comparator:"order"}),o.models.TeamLink=a.models.QuickLinks.extend({}),a.collect.SyncedQuickLinksBase=o.collect.SyncedCollection.extend({initialize:function(e){(e=e||{}).name=e.name||"quicklinks",e.model=e.model||a.models.QuickLinks,e.apiUrl=o.globals.urlRoot+"links",this.listenTo(this,"reorder",this.reorderItem),o.collect.SyncedCollection.prototype.initialize.call(this,e)},saveOptions:{},nextOrder:function(){return this.length?this.last().get("order")+100:100},comparator:"order",reorderItem:function(e){}}),a.collect.QuickLinks=a.collect.SyncedQuickLinksBase.extend({saveOptions:{patch:!0},reorderItem:function(e){var t={operations:[{REORDER:{move_id:e.move_id,move_target_id:e.move_target_id,move_offset:e.move_offset}}]},i=this;l.ajax({type:"PATCH",contentType:"application/json",data:JSON.stringify(t),beforeSend:setMomentumAuthHeader,url:o.globals.urlRootApi+"links"}).done(function(e){i.fetchFromServer()}).fail(function(e,t){})}}),a.collect.QuickLinksLegacy=Backbone.Collection.extend({model:a.models.QuickLinks,saveOptions:{},comparator:"order",localStorage:new Backbone.LocalStorage("momentum-quicklinks"),isLegacy:!0,initialize:function(){this.idAttribute="csid",this.serverIdAttribute=null,this.listenTo(this,"reorder",this.reorderItem),this.listenTo(this,"reset",this.migrate)},nextOrder:function(){return this.length?this.last().get("order")+100:100},fetch:function(e){return Backbone.Collection.prototype.fetch.call(this,e)},createOrderGaps:function(){var t=100;this.each(function(e){e.save({order:t},{silent:!0}),t+=100})},migrate:function(){this.each(function(e){e.get("csid")||e.save("csid",e.get("id")),e.id=e.get("csid")})},reorderItem:function(e){var t=this.findWhere({csid:e.move_id}),i=this.findWhere({csid:e.move_target_id}),n=0<e.move_offset?1:-1,s=this.indexOf(i),a=1;if(0<=s+n&&s+n<this.length){var o=this.at(s+n);(a=Math.abs(o.get("order")-i.get("order")))<=20&&(this.createOrderGaps(),a=Math.abs(o.get("order")-i.get("order")))}var l=i.get("order")+Math.ceil(a/2)*n;t.save({order:l},{silent:!0})}}),a.views.QuickLinks=Backbone.View.extend({attributes:{id:"quicklinks",class:"app-container"},offline:!0,initialFetchStarted:!1,events:{"click .toggle":"toggleShow","click .more-links":"toggleShow","click .team-menu-toggle":"toggleTeamMenu","click a":"handleClick","keypress #new-title":"createLink","keypress #new-url":"createLink","click .new-toggle":"showAdd","click .new-hide":"hideAdd","click .retry":"retryConnection","click .retry-add":"retryAdd","click .new":"inputsClicked",dragover:"dragover",dragend:"dragend",drop:"drop"},initialize:function(e){var t=this.logoUrlKey="cached-team-logo-url",i=this.logoBlobKey="cached-team-logo-blob",n=this;if(this.subViews=[],_.bindAll(this,"addOne","addAll","dragover","dragend","li_index"),this.renderedOnce=!1,this.name=this.options.name,this.linksOpenKey=this.name+"Open",this.team=this.options.team,this.template=this.team?a.templates.teamlinks:a.templates.quicklinks,this.linksLimit=3,this.logoUrl=this.options.logo,this.logoUrl){localStorage.getItem(t)!==this.logoUrl&&this.downloadLogo();var s=localStorage.getItem(i);s&&(this.logo=s)}this.attributes.id=this.options.id,this.isOpen=!this.team,this.$el.addClass(this.options.class),this.listenTo(o,"globalEvent:click globalEvent:esc",this.hidePopup),this.listenTo(o,"globalEvent:toggleQuickLinks",this.toggleShow),this.listenTo(this.collection,"remove",this.checkOptionalLinks),this.listenTo(this.collection,"add",this.added),this.listenTo(this.collection,"reset refresh",this.collectionReset),this.listenTo(this.collection,"error",this.collectionError),this.listenTo(o.models.customization,"change:linksVisible",this.visibleChanged),this.listenTo(o.models.customization,"change:linksKeepOpen",this.keepOpenChanged),this.listenTo(o.models.bookmarksSettings,"change:appsLocation",this.checkOptionalLinks),this.listenTo(o.models.bookmarksSettings,"change:chromeTabLocation",this.checkOptionalLinks),this.listenTo(o,"globalEvent:window:resize",this.handleResize),this.render(),this.doFetchIfNeeded(),this.team&&(this.listenTo(o.models.teamInfo,"change",function(){var e=o.models.teamInfo.get("team").TeamLogoUrl;e!==n.logo&&(n.logoUrl=e,n.downloadLogo())}),this.showBase()),void 0!==getBrowser().topSites?l.ajax({url:"chrome://favicon/size/16@2x/http://notfoundurl.com"}).done(function(e){n.notFoundIcon=e}):this.notFoundIcon=""},downloadLogo:function(){var e=this;localStorage.setItem(this.logoUrlKey,this.logoUrl);var t=new XMLHttpRequest;t.open("GET",this.logoUrl,!0),t.responseType="blob",t.addEventListener("load",function(){200===t.status&&e.loadBlob(t.response)},!1),t.send()},loadBlob:function(e){var i=this,t=new FileReader;t.onload=function(e){var t=e.target.result;localStorage.setItem(i.logoBlobKey,t),i.logo=t,i.$el.find(".team-logo").attr("src",t)},t.readAsDataURL(e)},checkOptionalLinks:function(){var i=this;this.$el.find("li").removeClass("first-link"),this.$el.find(".optional-link").each(function(e,t){i.checkInclusion(t)}),this.$el.find(".optional-link.show").first().addClass("first-link"),0===this.$el.find(".first-link").length&&this.$el.find("li").not(".optional-link").not(".placeholder").first().addClass("first-link"),i.toggleEmptyState(i.checkEmpty()),this.team&&this.$app.toggleClass("no-extra",this.linksLimit>=this.collection.length)},checkEmpty:function(){return 0==this.$el.find(".optional-link.show").length&&0==this.collection.size()},toggleEmptyState:function(e){this.$el.toggleClass("is-empty",e),this.hideAdd()},checkInclusion:function(e){var t=o.models.bookmarksSettings,i=l(e);i.toggleClass("show",t.get(i.attr("data-momo-id")+"Location")==i.attr("data-place"))},addPlaceholder:function(){this.$placeholder=l("<li></li>").addClass("placeholder"),this.$placeholder.appendTo(this.el)},removePlaceholder:function(){this.$placeholder.remove(),this.$placeholder=void 0},render:function(){return this.isChrome=isChrome(),this.$el.hasClass("app")&&(this.$el.css("height","auto"),this.$el.css("width","auto"),this.$el=this.$el.closest(".quicklinks")),this.$app=this.$el.find(".app"),this.maxHeight=this.getMaxHeight(),this.$el.hasClass("app")?this.$app=this.$el:this.team||(this.$app=this.$el.find(".app")),this.team?(this.$el.html(this.template(this)),this.$app=this.$el.find(".app")):this.$app.html(this.template(this)),this.$connectionMessage=this.$(".message"),this.$connectionMessage.css("display","block"),this.$baseLinks=this.$("ol").first(),this.$otherLinks=this.$app.find("ol"),this.renderedOnce=!0,o.models.customization.get("linksKeepOpen")&&"true"===localStorage.getItem(this.linksOpenKey)&&this.showPopup(),this.$list=this.$(".links-list"),this.$moreLinksButton=this.$(".more-links"),this.$app.toggleClass("no-extra",this.linksLimit>=this.collection.length),this.team&&!this.loadTriggered&&(o.widgetManager.appReady(a.info.id),this.loadTriggered=!0),this},destroy:function(){this.remove(),this.unbind()},keepOpenChanged:function(e){this.hidePopup()},visibleChanged:function(e){o.models.customization.get("linksVisible")?this.renderedOnce?this.$el.mFadeIn():this.render():this.$el.mFadeOut()},doFetch:function(){this.initialFetchStarted=!0,this.collection.fetch({reset:!0})},doFetchIfNeeded:function(){this.initialFetchStarted||this.doFetch()},collectionError:function(e,t,i){200!==t.status?this.failedConnection():this.successfulConnection()},showAdd:function(e){e.preventDefault(),e.stopPropagation();var t=this.$el.find(".new");t.is(":visible")||t.css("display","block"),l(e.target).hasClass("empty-toggle")&&l(e.target).css({opacity:0}),t.is(".open")||t.addClass("open"),this.$el.find(".new-title").attr("placeholder","Name").trigger("focus")},hideAdd:function(){this.$el.find(".new").removeClass("open"),this.$el.find(".new-title").val("").attr("placeholder","New Link"),this.$el.find(".new-url").val(""),this.checkEmpty()&&this.$el.find(".empty-toggle").css({opacity:1})},inputsClicked:function(e){e.stopPropagation()},retryConnection:function(e){e.preventDefault(),e.stopPropagation(),this.collection.fetch({reset:!0})},collectionReset:function(){this.addAll()},revealConnectionError:function(){this.$connectionMessage.mShow(),this.$el.addClass("show-message")},dismissConnectionError:function(){this.$connectionMessage.mHide(),this.$el.removeClass("show-message")},added:function(e){this.addOne(e),this.checkOptionalLinks()},addOne:function(e){var t=new a.views.QuickLink({model:e,parent:this});this.subViews.push(t);var i=null;this.team&&this.linksLimit>this.$baseLinks.children().length?i=this.$baseLinks:(i=this.$otherLinks,this.team&&!this.moreIsSet&&(this.$moreLinksButton.addClass("active"),this.$moreLinksButton.css("top",30+this.$el.outerHeight(!0)-this.$moreLinksButton.outerHeight(!0)/2+"px"))),i.append(t.render().$el)},addAll:function(){this.offline=!1,_.each(this.subViews,function(e){e&&e.destroy&&e.destroy()}),this.subViews=[];var i=this;if(this.collection.each(function(e){i.addOne(e)}),this.successfulConnection(),this.checkOptionalLinks(),this.team){!function e(){var t=i.$el.find(".team-dash-links-wrapper").outerHeight(!0);if(20<t)return void i.$el.find(".app-wrapper").css({top:6+t+"px"});setTimeout(e,100)}()}this.loadTriggered||(o.trigger(a.info.id+":loadedComplete"),this.loadTriggered=!0)},successfulConnection:function(){this.$el.find(".new").css("display","block"),this.dismissConnectionError()},failedConnection:function(e){var t=e?"retry-add":"retry";this.$connectionMessage.html('<span class="title">Trouble connecting…</span><span class="action '+t+'">Retry</span>'),this.revealConnectionError()},retryAdd:function(e){this.addLink()},createLink:function(e){13===e.keyCode&&this.addLink()},addLink:function(e){var t=this.$el.find("#new-title")[0].value,i=this.$el.find("#new-url")[0].value,n=this;if(!t)return this.$el.find("#new-title").addClass("pulse"),void _.delay(function(){n.$el.find("#new-title").removeClass("pulse")},1e3);if(!i)return this.$el.find("#new-url").addClass("pulse"),void _.delay(function(){n.$el.find("#new-url").removeClass("pulse")},1e3);if(this.offline)this.failedConnection(!0);else{var s=!1;/^chrome|chrome-extension|chrome-search:\/\//i.test(i)&&(s=!0),i=ensureUrlScheme(i),o.sendEvent("Quick Links","Add");var a=0;if(0<this.collection.length)a=this.collection.max(function(e){return e.get("order")}).get("order")+100;this.collection.create({title:t,url:i,local:s,order:a},{wait:!0,success:function(){n.successfulConnection(),n.$el.find(".new").addClass("open"),n.$el.find(".new input").val(""),n.$el.find(".new-title").attr("placeholder","Name").trigger("focus")},error:function(e,t,i){n.failedConnection(!0)}})}},dragover:function(e){return e.preventDefault(),e.stopPropagation(),!(e.originalEvent.dataTransfer.dropEffect="move")},drop:function(e){e.preventDefault(),e.stopPropagation(),this.checkOptionalLinks()},dragend:function(e){if(e.originalEvent.dataTransfer.dropEffect="move",e.preventDefault(),e.stopPropagation(),"quicklink"===this.dragmode){this.dragging.$el.css("display","list-item"),this.removePlaceholder();var t=this.dragging.model;this.collection.trigger("reorder",{move_id:t.get([t.collection.serverIdAttribute||t.collection.idAttribute]),move_target_id:this.move_target_id,move_offset:this.move_offset})}return this.checkOptionalLinks(),!1},toggleTeamMenu:function(){this.teamMenuIsOpen?this.forceHidePopup(!0):this.showPopup(!0)},toggleHandler:function(e){this.toggleShow(e)},toggleShow:function(){this.isOpen?this.forceHidePopup():this.showPopup(),this.doFetchIfNeeded()},showBase:function(){this.doFetchIfNeeded()},showPopup:function(e){var t;e?(t="active",this.teamMenuIsOpen=!0,this.isOpen&&this.forceHidePopup()):(t="show",this.isOpen=!0,this.teamMenuIsOpen&&this.forceHidePopup(!0),localStorage.setItem(this.linksOpenKey,"true")),this.$el.addClass(t).outerWidth(),this.$el.addClass(t+"-fade-in")},forceHidePopup:function(e){var t,i=this;e?(t="active",this.teamMenuIsOpen=!1):(t="show",this.isOpen=!1,this.hideAdd(),localStorage.setItem(this.linksOpenKey,"false")),this.$el.removeClass(t+"-fade-in").bind("transitionend webkitTransitionEnd",function(){l(this).unbind("transitionend webkitTransitionEnd"),i.$el.removeClass(t)})},hidePopup:function(e){e!==this&&(e&&e.originalEvent&&"click"===e.type&&e.target&&l.contains(this.$el[0],e.target)||(this.$el.removeClass("active"),this.$el.find(".new").is(".open")?this.hideAdd():this.isOpen&&!o.models.customization.get("linksKeepOpen")&&this.forceHidePopup()))},handleClick:function(e){e.stopPropagation(),e.preventDefault();var t=e.currentTarget.href;o.models.bookmarksSettings.get("openInNewTab")||e.metaKey?getBrowser().tabs.create({url:t}):getBrowser().tabs.update({url:t})},li_index:function(e){return this.$("li").index(e)},urlInvalid:function(){var e=this;this.$el.find("#new-url").addClass("pulse"),_.delay(function(){e.$el.find("#new-url").removeClass("pulse")},1e3)},getMaxHeight:function(){var e=this.team?50:0,t=this.team?25:0;return l(window).height()-135-40-e-t},setMaxWidgetHeight:function(){var e=this.getMaxHeight();this.$list.css("max-height",e)},handleResize:function(){this.isOpen&&this.setMaxWidgetHeight()}}),a.views.QuickLink=Backbone.View.extend({tagName:"li",template:a.templates["quicklinks-item-template"],events:{"keypress .todo-input":"updateOnEnter","click .destroy":"delete",dragstart:"dragstart",dragenter:"dragenter","click a":"handleClick"},initialize:function(e){_.bindAll(this,"dragstart","dragenter"),this.parent=e.parent,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:archive destroy",this.remove)},render:function(){var i=this,n=this.model.get("url");this.moreIsSet=!1;var s=getFavIcon(n);if(this.parent.team)this.loadLink(!1);else{var a=new Image;this.loadLink(!1),isChrome()?getBrowser().permissions.contains(o.models.bookmarksSettings.permissions,function(e){if(e){var t="chrome://favicon/size/16@2x/"+n;l.ajax({url:t}).done(function(e){e===i.parent.notFoundIcon?a.src=s:i.loadLink(t)})}else a.src=s}):a.src=s,a.onload=function(){i.loadLink(s)}}return i},loadLink:function(e){var t={title:o.utils.captionFormatter(this.model.get("title")),url:this.model.get("url"),local:this.model.get("local"),favicon_url:e,team:this.parent.team};this.$el.html(this.template(t)),this.$el.prop("draggable","true")},destroy:function(){this.remove(),this.unbind()},delete:function(e){e.stopPropagation(),o.sendEvent("Quick Links","Delete"),this.model.destroy()},dragstart:function(e){e.originalEvent.dataTransfer.effectAllowed="move",e.originalEvent.dataTransfer.setData("text","dummy"),this.parent.dragmode="quicklink",this.parent.dragging=this},dragenter:function(e){if("quicklink"===this.parent.dragmode){this.parent.dragging.$el.hide(),this.parent.$placeholder||this.parent.addPlaceholder();var t=this.model.get(this.model.collection.serverIdAttribute||this.model.collection.idAttribute);this.parent.li_index(this.parent.$placeholder)<this.parent.li_index(this.$el)?(this.$el.after(this.parent.$placeholder),this.parent.move_target_id=t,this.parent.move_offset=1):(this.$el.before(this.parent.$placeholder),this.parent.move_target_id=t,this.parent.move_offset=-1);var i=this.parent.$placeholder;this.parent.$placeholder.css("display","list-item"),i.height(this.$el.height()),i.after(this.parent.dragging.$el)}},handleClick:function(e){e.stopPropagation(),e.preventDefault(),o.models.bookmarksSettings.get("openInNewTab")||e.metaKey?getBrowser().tabs.create({url:e.currentTarget.href}):getBrowser().tabs.update({url:e.currentTarget.href})},updateOnEnter:function(e){13===e.keyCode&&this.close(l(e.currentTarget).data("field"))}}),a.styles.style(),a};m.addinManager&&m.addinManager.registerAddinFn("3b23bf88-bde9-40df-bfca-bf20add886c9",fn_addin);
var fn_addin=function(r,d,t){var i=i||{};i.styles=i.styles||{},i.commands=i.commands||{},i.dependencies=t||i.dependencies||{},i.styles.style=function(){},i.views=i.views||{},i.collect=i.collect||{},i.models=i.models||{},i.templates=i.templates||{},i.info={addin:"DD91D97E-FC83-4FCA-B5CB-D89EB2E1DD0F",id:"settings_mantras",dependencies:["settings"],commands:["settings.panels.mantras"]},r.console.log(r.elapsed()+": "+i.info.id+" started"),i.templates=i.templates||{},i.templates.item=Handlebars.template({1:function(t,s,e,n){return'\t\t\t--\x3e<span class="control control-edit u--clickable" title="Edit"><i class="icon-edit"></i></span>\x3c!--\n\t\t\t--\x3e<span class="control control-delete u--clickable" title="Delete"><i class="icon-trash"></i></span>\x3c!--\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,s,e,n){var i,a,o=s.helperMissing,l="function",r=this.escapeExpression;return'<div class="view" title="'+r(typeof(a=null!=(a=s.title||(null!=t?t.title:t))?a:o)===l?a.call(t,{name:"title",hash:{},data:n}):a)+'">\n\t<div class="mantra">\n\t\t<span class="mantra-body u--selectable">'+r(typeof(a=null!=(a=s.body||(null!=t?t.body:t))?a:o)===l?a.call(t,{name:"body",hash:{},data:n}):a)+'</span>\n\t</div>\n\n\t<span class="controls">\x3c!--\n\t\t--\x3e<span class="control control-svg control-activate u--clickable" title='+r(typeof(a=null!=(a=s.labelCheck||(null!=t?t.labelCheck:t))?a:o)===l?a.call(t,{name:"labelCheck",hash:{},data:n}):a)+'>\n\t\t\t<i class="icon-check"></i>\n\t\t</span>\x3c!--\n\t\t--\x3e<span class="control control-svg control-pin u--clickable" title='+r(typeof(a=null!=(a=s.labelPin||(null!=t?t.labelPin:t))?a:o)===l?a.call(t,{name:"labelPin",hash:{},data:n}):a)+'>\n\t\t\t<svg class="icon icon-pin" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 481.71 481.72"><path d="M106.12,10.76,10.77,106.13a36.72,36.72,0,0,0,45.92,56.8l109.6,127.41a100.11,100.11,0,0,0,20,113.32,35.27,35.27,0,0,0,49.86,0l57.33-57.31L481.71,481.72,346.35,293.52l57.31-57.31a35.3,35.3,0,0,0,0-49.88,100.16,100.16,0,0,0-113.29-20L162.93,56.67a36.72,36.72,0,0,0-56.81-45.91Z" transform="translate(0 0)"/></svg>\n\t\t</span>\x3c!--\n\t\t--\x3e<span class="control control-svg control-heart u--clickable '+r(typeof(a=null!=(a=s.isFavClass||(null!=t?t.isFavClass:t))?a:o)===l?a.call(t,{name:"isFavClass",hash:{},data:n}):a)+'" title="'+r(typeof(a=null!=(a=s.isFavTitle||(null!=t?t.isFavTitle:t))?a:o)===l?a.call(t,{name:"isFavTitle",hash:{},data:n}):a)+'">\n\t\t\t<svg class="icon icon-heart" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 953 1000"><path d="M1 329q7-115 79-191h2l2-2q88-76 199-76t191 70q32-28 67-45l2-2h2q56-23 117-23 88-2 161 43t110 124v2l2 4q30 106 10 202t-80 175q-62 88-162 172 0 2-2 2-49 45-107 90-34 25-59 41-33 23-55 23l-6 2-5-2q-28-3-59-29-10-6-21-16t-16-13h-2Q125 692 43 540v-2Q-6 444 1 329zm85 1"></path></svg>\n\t\t</span>\x3c!--\n'+(null!=(i=s.if.call(t,null!=t?t.onCustomSubnav:t,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+'\t\t--\x3e<span class="delete-group">\x3c!--\n\t\t\t--\x3e<span class="control delete-msg">Delete?</span>\x3c!--\n\t\t\t--\x3e<span class="control delete-loading">Deleting...</span>\x3c!--\n\t\t\t--\x3e<span class="control delete-failed u--clickable" title="Click to retry">Trouble connecting...</span>\x3c!--\n\t\t\t--\x3e<span class="control delete-yes u--clickable" title="Confirm">\n\t\t\t\t<i class="icon icon-checkmark">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 577.95 469.42"><polygon points="195.09 469.42 137.44 424.64 140.4 421.42 0 298 46.22 245.43 187.68 369.79 526.33 0 577.95 47.28 229.72 427.53 195.09 469.42"/></svg>\n\t\t\t\t</i>\n\t\t\t</span>\x3c!--\n\t\t\t--\x3e<span class="control delete-no u--clickable" title="Cancel">\n\t\t\t\t<i class="icon icon-x">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 47.97 47.97"><path d="M28.23,24,47.09,5.12A3,3,0,0,0,42.85.88L24,19.74,5.12.88A3,3,0,0,0,.88,5.12L19.74,24,.88,42.85a3,3,0,1,0,4.24,4.24L24,28.23,42.85,47.09a3,3,0,0,0,4.24-4.24Z" transform="translate(0 0)"/></svg>\n\t\t\t\t</i>\n\t\t\t</span>\n\t\t</span>\n\t</span>\n</div>\n\n<form class="edit settings-form-basic list-edit-form">\n\t<input class="list-edit-input" placeholder="Mantra" value="'+r(typeof(a=null!=(a=s.body||(null!=t?t.body:t))?a:o)===l?a.call(t,{name:"body",hash:{},data:n}):a)+'" maxlength="'+r(typeof(a=null!=(a=s.inputLengthMaxHtml||(null!=t?t.inputLengthMaxHtml:t))?a:o)===l?a.call(t,{name:"inputLengthMaxHtml",hash:{},data:n}):a)+'">\x3c!--\n\t--\x3e<span class="char-count"></span>\x3c!--\n\t--\x3e<span class="cancel u--clickable">✕</span>\n</form>\n'},useData:!0}),i.templates.main=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,s,e,n){var i,a=s.helperMissing,o="function",l=this.escapeExpression;return'<div class="main-container">\n\t\x3c!-- Header --\x3e\n\n\t<div class="subpanel-header">\n\t\t<span class="button-advanced">'+l(typeof(i=null!=(i=s.advancedLabel||(null!=t?t.advancedLabel:t))?i:a)===o?i.call(t,{name:"advancedLabel",hash:{},data:n}):i)+'<i class="icon icon-angle-down"></i></span>\n\t\t<h3>'+l(typeof(i=null!=(i=s.title||(null!=t?t.title:t))?i:a)===o?i.call(t,{name:"title",hash:{},data:n}):i)+'</h3>\n\t\t<p class="description">'+l(typeof(i=null!=(i=s.description||(null!=t?t.description:t))?i:a)===o?i.call(t,{name:"description",hash:{},data:n}):i)+'</p>\n\t</div>\n\n\t\x3c!-- Feeds --\x3e\n\n\t<div class="wrapper-advanced">\n\t\t<h4>General</h4>\n\t\t<ul class="settings-list options-list">\n\t\t\t<li class="slide-toggle mantras-enabled">\n\t\t\t\t<span class="toggle-slider"><svg class="toggle-switch" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg></span>\n\t\t\t\t<span class="setting-name">'+l(typeof(i=null!=(i=s.labelEnable||(null!=t?t.labelEnable:t))?i:a)===o?i.call(t,{name:"labelEnable",hash:{},data:n}):i)+'</span>\n\t\t\t\t<span class="option-message">Show mantras periodically throughout the day</span>\n\t\t\t</li>\n\t\t\t<li class="frequencies slide-toggle">\n\t\t\t\t<span class="toggle-options">\n\t\t\t\t\t<span class="toggle-option frequency" id="low">Rarely</span>\n\t\t\t\t\t<span class="toggle-divider">|</span>\n\t\t\t\t\t<span class="toggle-option frequency" id="medium">Sometimes</span>\n\t\t\t\t\t<span class="toggle-divider">|</span>\n\t\t\t\t\t<span class="toggle-option frequency" id="high">Often</span>\n\t\t\t\t\t<span class="toggle-divider">|</span>\n\t\t\t\t\t<span class="toggle-option frequency" id="always">Always</span>\n\t\t\t\t</span>\n\t\t\t\t<span class="setting-name">Frequency</span>\n\t\t\t\t<span class="badge plus-badge">PLUS</span>\n\t\t\t\t<span class="option-message">How often mantras appear</span>\n\t\t\t</li>\n\t\t</ul>\n\n\t\t<h4>Feeds</h4>\n\t\t<ul class="feeds settings-list options-list">\n\t\t\t<li class="slide-toggle momo">\n\t\t\t\t<span class="toggle-slider"><svg class="toggle-switch" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg></span>\n\t\t\t\t<span class="setting-name">'+l(typeof(i=null!=(i=s.labelMomo||(null!=t?t.labelMomo:t))?i:a)===o?i.call(t,{name:"labelMomo",hash:{},data:n}):i)+'</span>\n\t\t\t\t<span class="option-message">See a daily mantra from our curated feed</span>\n\t\t\t</li>\n\t\t\t<li class="slide-toggle custom">\n\t\t\t\t<span class="toggle-slider"><svg class="toggle-switch" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg></span>\n\t\t\t\t<span class="setting-name">'+l(typeof(i=null!=(i=s.labelCustom||(null!=t?t.labelCustom:t))?i:a)===o?i.call(t,{name:"labelCustom",hash:{},data:n}):i)+'</span>\n\t\t\t\t<span class="badge plus-badge">PLUS</span>\n\t\t\t\t<span class="feed-empty">Empty… Click to add</span>\n\t\t\t\t<span class="option-message">Personalize with your own mantras, skip and pin mantras, and more!</span>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n\n\n\n\t\x3c!-- Subnav + add button --\x3e\n\n\t<nav class="settings-subnav">\n\t\t<div class="subnav-titles">\n\t\t\t<h4 class="customs">'+l(typeof(i=null!=(i=s.labelCustom||(null!=t?t.labelCustom:t))?i:a)===o?i.call(t,{name:"labelCustom",hash:{},data:n}):i)+'</h4>\x3c!--\n\t\t\t--\x3e<h4 class="favs">Favorites</h4>\x3c!--\n\t\t\t--\x3e<h4 class="history">History</h4>\n\t\t</div>\n\t\t<button class="button list-add-button">'+l(typeof(i=null!=(i=s.labelAdd||(null!=t?t.labelAdd:t))?i:a)===o?i.call(t,{name:"labelAdd",hash:{},data:n}):i)+'</button>\n\t</nav>\n\t<div class="settings-subnav-placeholder"></div>\n\n\n\n\t\x3c!-- Mantra lists --\x3e\n\t<div class="list-wrapper has-subnav">\n\n\t\t<div class="settings-loading">\n\t\t\t<p class="settings-empty-loading"><i class="loading-icon"></i>Loading...</p>\n\t\t</div>\n\n\t\t\x3c!-- Add form + custom list --\x3e\n\t\t<div class="list-body mantra-list-body custom-wrapper">\n\t\t\t<form class="settings-form-basic list-add-form">\n\t\t\t\t<div class="settings-form-row">\n\t\t\t\t\t<input class="list-add-input" placeholder="Mantra" maxlength="'+l(typeof(i=null!=(i=s.inputLengthMaxHtml||(null!=t?t.inputLengthMaxHtml:t))?i:a)===o?i.call(t,{name:"inputLengthMaxHtml",hash:{},data:n}):i)+'">\n\t\t\t\t\t<span class="char-count"></span>\n\t\t\t\t\t<span class="cancel u--clickable">✕</span>\n\t\t\t\t</div>\n\t\t\t\t<span class="suggestions">\n\t\t\t\t\t<span class= "suggestions-label">Suggestions</span>\x3c!--\n\t\t\t\t\t--\x3e<span class= "list-add-suggestions">\x3c!--\n\t\t\t\t\t\t--\x3e<span class="mantra-suggestion-wrapper"><span class="mantra-suggestion list-add"></span><span class="remove">✕</span></span>\x3c!--\n\t\t\t\t\t\t--\x3e<span class="mantra-suggestion-wrapper"><span class="mantra-suggestion list-add"></span><span class="remove">✕</span></span>\x3c!--\n\t\t\t\t\t\t--\x3e<span class="mantra-suggestion-wrapper"><span class="mantra-suggestion list-add"></span><span class="remove">✕</span></span>\x3c!--\n\t\t\t\t\t--\x3e</span>\n\t\t\t\t\t<span class="empty-suggestions">No more suggestions</span>\n\t\t\t\t</span>\n\t\t\t</form>\n\n\t\t\t<ul class="settings-list custom-list"></ul>\n\t\t\t<div class="settings-empty custom-empty">\n\t\t\t\t<p class="settings-empty-title empty-add-shortcut">Get inspired by adding your personal mantras</p>\n\t\t\t\t<p class="settings-empty-description empty-add-shortcut">Click + Add Mantra to get started</p>\n\t\t\t</div>\n\t\t</div>\n\n\n\t\t\x3c!-- Favs list --\x3e\n\t\t<div class="list-body mantra-list-body favs-wrapper">\n\t\t\t<ul class="settings-list favs-list"></ul>\n\t\t\t<div class="settings-empty favs-empty">\n\t\t\t\t<p class="settings-empty-title">No favorite mantras</p>\n\t\t\t\t<p class="settings-empty-description">Click the heart icon on a mantra to start your collection</p>\n\t\t\t</div>\n\t\t</div>\n\n\n\n\t\t\x3c!-- History list --\x3e\n\t\t<div class="list-body mantra-list-body history-wrapper">\n\t\t\t<ul class="settings-list history-list"></ul>\n\t\t\t<div class="settings-empty history-empty">\n\t\t\t\t<p class="settings-empty-title">You will see your past mantras here</p>\n\t\t\t\t<p class="settings-empty-description">Can\'t find any history for this account</p>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n\n\t\x3c!-- Off state --\x3e\n\n\t<div class="off-state">\n\t\t<span class="button mantras-enabled">'+l(typeof(i=null!=(i=s.labelEnable||(null!=t?t.labelEnable:t))?i:a)===o?i.call(t,{name:"labelEnable",hash:{},data:n}):i)+'</span>\n\t</div>\n</div>\n\n\n\n\x3c!-- ONBOARD --\x3e\n\n<div class="settings-mantras-onboard">\n\t<div>\n\t\t<h3>Introducing Mantras</h3>\n\t\t<div class="text-wrapper">\n\t\t\t<p class="text">Build positive mental habits with simple phrases known as mantras. Mantras will appear throughout the day in place of the “Good morning” (etc.) greeting.</p>\n\t\t\t<p class="text">Center yourself with friendly reminders, reinforce new thought patterns, and bring attention to the values or principles that are most important to you.</p>\n\t\t</div>\n\t\t<button class="hide-onboard button button-primary">Get Started</button>\n\t</div>\n</div>\n'},useData:!0}),i.styles=i.styles||{},i.styles.style=function(){var t=document.createElement("style");t.type="text/css",t.innerHTML=".settings-mantras .main-container{display:none}.settings-mantras.loading{height:100%}.settings-mantras .list-wrapper{position:relative}.settings-mantras .settings-loading{position:absolute;top:0;bottom:0;left:0;right:0;display:none}.settings-mantras.loading .settings-loading{display:flex}.settings-mantras .settings-empty{padding:98px 0}.settings-mantras .favs-list .list-separator{padding:7px 0 3px;background:rgba(55,55,55,1);border-top:none;font-size:85.714%;opacity:.8;text-align:left;text-transform:uppercase}.light .settings-mantras .favs-list .list-separator{background:rgba(0,0,0,.1);opacity:1}.settings-mantras .off-state{margin-top:20px;display:none;text-align:center}.settings-mantras .list-add-form .suggestions{margin:3px 0 0;display:inline-block;font-size:.75rem}.list-add-form .empty-suggestions,.settings-mantras .list-add-form .suggestions-label{padding:4px 0;display:inline-block;opacity:.5}.settings-mantras .list-add-form .suggestions-label:hover{cursor:pointer;opacity:.7}.settings-mantras .list-add-form .list-add-suggestions{display:none}.settings-mantras .list-add-form .mantra-suggestion-wrapper{display:inline-block}.settings-mantras .list-add-form .mantra-suggestion{padding:4px 3px 4px 0;display:inline-block;color:rgba(255,255,255,.6)}.settings-mantras .list-add-form .mantra-suggestion:hover{color:rgba(255,255,255,.8);cursor:pointer}.light .settings-mantras .list-add-form .mantra-suggestion{color:rgba(15,15,15,.6)}.light .settings-mantras .list-add-form .mantra-suggestion:hover{color:rgba(15,15,15,.8)}.settings-mantras .list-add-form .remove{padding:4px 12px 4px 3px;display:inline-block;opacity:.4;font-size:.6875rem}.settings-mantras .list-add-form .remove:hover{opacity:.9;cursor:pointer}.settings-mantras .list-add-form .empty-suggestions{display:none}.settings-mantras form input{font-size:1rem}.settings-mantras .settings-form-row{display:flex;align-items:center}.mantra-settings-pop{display:none}.mantra-settings-pop .subpanel-header .description{margin-bottom:20px}.mantra-settings-pop .mantras-enabled.border-fix{border-bottom:1px solid rgba(255,255,255,.15)}.light .mantra-settings-pop .mantras-enabled.border-fix{border-bottom:1px solid rgba(0,0,0,.1)}.settings-mantras .feeds .feed-empty{padding:5px;font-size:86.66667%;opacity:.5}.settings-mantras .feeds .feed-empty:hover{opacity:.8}.settings-mantras-onboard{height:380px;margin:0 -30px;display:none;flex-direction:column;align-items:center;justify-content:center;overflow-y:hidden!important;text-align:center}.settings-mantras-onboard.show{display:flex}.settings-mantras.loading .settings-mantras-onboard{display:none}.settings-mantras-onboard h3{margin-bottom:0}.settings-mantras-onboard .text-wrapper{margin:12px 30px 15px}.settings-mantras-onboard .text{font-size:110%;line-height:1.4;opacity:.5}.settings-mantras-onboard .button-primary{margin:5px 0 8px;padding:9px 26px;font-size:105%}.mantra-item{transition:opacity .2s ease,max-height .2s ease}.mantra-item.active .controls,.mantra-item.pinned .controls{opacity:1}.mantra-item.hide{max-height:0;opacity:0;padding:0;overflow:hidden}.mantra-item .mantra-body{margin:-11px 110px -11px -6px;padding:11px 6px;display:block;cursor:pointer;font-size:1rem;line-height:1.2;overflow:hidden;text-overflow:ellipsis}.mantra-item.editing .edit{display:flex}.custom-wrapper .mantra-item{cursor:pointer}.mantra-item .delete-group .delete-loading{display:none;opacity:.5}.delete-group.loading .delete-no,.delete-group.loading .delete-yes,.mantra-item .delete-group.loading .delete-msg{display:none}.mantra-item .delete-group.loading .delete-loading{display:inline-block}.delete-group.failed .delete-no,.delete-group.failed .delete-yes,.mantra-item .delete-group .delete-failed,.mantra-item .delete-group.failed .delete-msg{display:none}.mantra-item .delete-group.failed .delete-failed{display:inline-block}.mantra-item.active .control-activate,.mantra-item.failed .controls,.mantra-item.loading .controls,.mantra-item.selected .controls{opacity:1}.mantra-item.active .control-activate:hover{cursor:auto;opacity:1}",document.getElementsByTagName("head")[0].appendChild(t)},i.collect.Mantras=Backbone.Collection.extend({loadedOnce:!1,initialize:function(){this.model=i.models.Mantra,this.listenToOnce(this,"reset",this.onReset)},onReset:function(){this.loadedOnce=!0},comparator:function(t,s){var e=this.sortAttribute||"sort_order",n=t.get(e),i=s.get(e);return n==i?0:n<i?this.reverse_sort?1:-1:i<n?this.reverse_sort?-1:1:void 0},favs:function(){return this.filter(function(t){return t.get("is_favorite")})},favsSorted:function(){var s=[],e=[],n=this;return this.favs().forEach(function(t){s.push({body:t.get("body"),id:t.id})}),(s=_(s).sortBy("body")).forEach(function(t){e.push(n.get(t.id))}),e}}),i.models.Mantra=Backbone.Model.extend({defaults:function(){return{body:"New Mantra"}},save:function(t,s){(s=s||{}).patch=!0;var n=s.success;s.success=function(t,s,e){r.models.mantraManager.updateInFeed(i),n&&n(t,s,e)};var i=this;Backbone.Model.prototype.save.call(this,t,s)}}),i.models.MantraSettingsManager=Backbone.Model.extend({gaTitle:"Mantra Settings",labelCustom:"My Mantras",newModels:[],defaults:{showFavs:!1,showHistory:!1,suggestionIndex:0},feedMap:{momo:"mantra-feed-momentum",custom:"mantra-feed-custom"},initialize:function(){this.defaultFeedState={momo:!0,custom:!1},this.plusUser=r.conditionalFeatures.featureEnabled("plus"),this.settings=new r.models.GenericSettings("settings/mantra"),r.isLoggedIn()&&this.settings.fetch(),this.initCustom(),this.initFavorites(),this.initHistory();var t=this;this.listenTo(r,"mantras:refresh",function(){t.refreshFavorites(),t.plusUser&&t.collection.fetch({reset:!0})})},initCustom:function(){return this.collection||(this.collection=new i.collect.Mantras,this.collection.url=r.globals.urlRoot+"settings/mantra/mantras",this.listenTo(this.collection,"remove",this.onCollectionRemove),this.listenTo(this.collection,"user-change",this.handleUserChange),this.plusUser?this.collection.fetch({reset:!0}):this.collection.trigger("reset")),this.collection},initFavorites:function(){return this.favorites||(this.favorites=new i.collect.Mantras,this.favorites.url=r.globals.urlRoot+"mantras/favorites",this.favorites.sortAttribute="last_updated",this.favorites.reverse_sort=!1),this.favorites},initHistory:function(){return this.history||(this.history=new i.collect.Mantras,this.history.url=r.globals.urlRoot+"mantras/history",this.history.reverse_sort=!0,this.history.load_more=r.utils.getActiveDateString(),this.history.parse=function(t){return self.history.load_more=t.load_more,t.history}),this.history},pinMantra:function(t){var s=t.get("is_custom")?"custom":"momo";this.isFeedActive(s)||this.toggleFeed(s),r.models.mantraManager.pinMantra(t,"settings")},toggleFavorite:function(t){var s,e,n,i=t.get("_id")||t.get("id");s=this.collection.findWhere({id:i}),e=this.favorites.findWhere({id:i}),n=this.history.where({_id:i});var a=t.get("is_favorite"),o=!a;e&&e.set({is_favorite:o}),s&&s.set({is_favorite:o}),n&&n.map(function(t){t.set({is_favorite:o})}),r.models.mantraManager.toggleFav(t).catch(function(){e&&e.set({is_favorite:a}),s&&s.set({is_favorite:a}),n&&n.map(function(t){t.set({is_favorite:a})})})},refreshFavorites:function(){this.initFavorites().fetch({reset:!0})},refreshHistory:function(){this.initHistory().fetch({reset:!0})},onCollectionRemove:function(){r.trigger("sync:download","mantra"),this.customEmpty()&&this.collection.trigger("user-change"),this.history&&this.history.loadedOnce&&this.refreshHistory(),this.favorites&&this.favorites.loadedOnce&&this.refreshFavorites()},showPlusUpsellNotif:function(){var t={targetRegion:"settings",sourceEvent:"customMantras-toggleFeed",buttonText:"Learn more",title:this.labelCustom,description:"Mantras"};r.commandManager.execute("upsell.message",t)},getCollection:function(){return this.collection},customEmpty:function(){return 0===this.collection.length},favsEmpty:function(){return 0===this.favorites.length},historyEmpty:function(){return 0===this.history.length},incrementSuggestionIndex:function(t){var s=this.get("suggestionIndex");return t-1<=s?s=0:s++,this.set("suggestionIndex",s),s},handleItemDelete:function(t,s){var e=r.models.mantraManager.getPinnedMantra(),n=r.models.mantraManager.getActiveItem();e&&r.models.mantraManager.model.id===e.id&&(n&&t.id===n.get("_id")&&r.models.mantraManager.skipItem(),r.models.mantraManager.setPinnedVars());var i=this;this.customEmpty()&&setTimeout(function(){this.toggleFeed("custom"),i.isFeedActive("momo")||r.models.mantraManager.trigger("mantra-custom-only-final-delete")},s)},handleItemEdit:function(t){t.id===r.views.greeting.mantraActiveId&&r.models.mantraManager.trigger("mantra-active-edit"),r.models.mantraManager.updateInFeed(t)},setFrequency:function(t){r.models.mantraSettings.save({frequency:t}),r.models.mantraManager.randomizeFrequencyData()},nextFrequency:function(){var t,s=r.models.mantraSettings.get("frequency");t="low"===s?"medium":"medium"===s?"high":"low",r.models.mantraSettings.save({frequency:t}),r.models.mantraManager.randomizeFrequencyData()},isFeedActive:function(t){var s=this.settings.get(this.feedMap[t]);return void 0===s?this.defaultFeedState[t]:s},toggleFeed:function(t){if(this.settings.toggle(this.feedMap[t]),this.autosetEnabled(t),"custom"!==t||!this.customEmpty()){var s=r.models.mantraManager.getActiveItem();if(s)(s.get("is_custom")?"custom":"momo")!==t||this.isFeedActive(t)||(r.models.mantraManager.trigger("wait-for-mantra"),r.models.mantraManager.skipItem());!this.isFeedActive(t)&&this.customEmpty()&&r.models.mantraManager.trigger("mantra-custom-only-empty")}},autosetEnabled:function(t){var s="momo"===t?"custom":"momo";this.isFeedActive(t)||this.isFeedActive(s)?this.isFeedActive(t)&&!r.models.mantraManager.isEnabled()&&r.models.customization.set("mantraVisible",!0):this.toggleFeed(s)}}),i.views.Mantra=Backbone.View.extend({attributes:{class:"content-item mantra-item"},tagName:"li",template:i.templates.item,events:{"click .mantra":"handleClickSetActive","click .control-activate":"handleClickSetActive","click .control-pin":"handleClickPin","click .control-heart":"handleClickFav","click .control-edit":"handleClickEdit","click .control-delete":"toggleDeleteConf","click .delete-yes":"deleteItem","click .delete-no":"toggleDeleteConf","keyup .list-edit-input":"handleKeyupEsc","keypress .list-edit-input":"handleKeypressEnter","focus .list-edit-input":"updateCharCountEdit","input .list-edit-input":"updateCharCountEdit","click .cancel":"handleClickCancel"},initialize:function(t){this.main=t.main,this.isCustom=t.isCustom,this.onCustom=t.customSubnav,this.manager=this.main.manager,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",onDestroyModel),this.listenTo(this.manager,"item-editing",preventMultipleEdits),this.listenTo(this.manager,"toggle-list-add-form",returnToViewMode),this.listenTo(this.manager,"show-favs",this.onShowFavs)},render:function(){var t=r.models.mantraManager.formatMantraForDisplay(this.model.get("body"),!1),s=this.model.get("is_favorite"),e={body:t.start+t.end,labelCheck:this.main.labelActivate,labelPin:this.main.labelPin,isFavClass:s?"active":"",isFavTitle:s?"Unfavorite":"Favorite",showCustomControls:this.main.plusUser&&this.isCustom,onCustomSubnav:this.onCustom,inputLengthMaxHtml:this.main.inputLengthMaxHtml,title:this.setItemTooltip()};return this.$el.html(this.template(e)),this.$el.attr("data-mantra-id",this.model.get("_id")||this.model.get("id")),this.$input=this.$(".list-edit-input"),this.$deleteGroup=this.$(".delete-group"),this.main.syncPinnedMantra(this.$el.parent()),this.main.syncActiveMantra(this.$el.parent()),this},setItemTooltip:function(){var t="";return this.manager.get("showHistory")&&(t=getFriendlyDate(this.model.get("display_date"))),t},handleClickSetActive:function(t){t.stopPropagation(),this.main.plusUser?(this.setMantraActive(),r.sendEvent(this.manager.gaTitle,"Set Active")):this.main.showPlusUpsellNotif("activate")},handleClickPin:function(t){t.stopPropagation(),this.main.plusUser?(this.main.pinningMantra=!0,this.manager.pinMantra(this.model,"settings"),this.main.syncActiveMantra(this.$el.parent()),this.main.syncPinnedMantra(this.$el.parent()),r.sendEvent(this.main.gaTitle,"Pin")):this.main.showPlusUpsellNotif("pin")},handleClickFav:function(t){t.stopPropagation(),r.sendEvent(this.main.gaTitle,"Fav"),this.manager.toggleFavorite(this.model),this.model.attributes.is_favorite||this.main.checkForFavsEmpty()},setMantraActive:function(){var t=this;r.models.mantraManager.setActive(this.model).then(function(){r.models.mantraManager.trigger("show-mantra"),t.main.syncActiveMantra(t.$el.parent()),t.main.syncPinnedMantra(t.$el.parent())})},hide:function(){this.$el.addClass("hide")},handleClickEdit:function(){changeToEditMode(this,this.$input)},toggleDeleteConf:function(){toggleDeleteConf(this)},deleteItem:function(){var t=this;if(!this.$deleteGroup.hasClass("loading")){this.$deleteGroup.removeClass("failed").addClass("loading");var s=this.model.get("id");this.model.destroy({wait:!0,success:function(){r.models.mantraManager.trigger("mantra:deleted",s)},error:function(){t.$deleteGroup.removeClass("loading").addClass("failed")}}),r.sendEvent(this.manager.gaTitle,"Delete")}},handleKeypressEnter:function(t){handleKeypressEnter(t,this.processEditForm.bind(this),this.$input)},handleKeyupEsc:function(t){handleKeyupEsc(t,this.abortEdit.bind(this))},processEditForm:function(){processEditFormBasic(this)},handleClickCancel:function(){this.abortEdit()},abortEdit:function(){abortEditBasic(this)},updateCharCountEdit:function(t){updateCharCount(t,this.main)},onShowFavs:function(){returnToViewMode(this)},destroy:function(){this.remove(),this.unbind(),this.main.checkForFavsEmpty(),this.main.checkForHistoryEmpty()}});var s=i.dependencies.settings;return i.views.Main=s.views.SettingsPanel.extend({attributes:{id:"settings-mantras",class:"settings-view settings-content settings-mantras"},deletingFinalItem:!1,gaTitle:"Mantra Settings",inputLengthMaxDatabase:80,inputLengthMaxHtml:100,inputLengthShow:20,inputLengthWarn:40,itemEditingId:null,labelAdd:"+ Add Mantra",labelCustom:"My Mantras",labelEnable:"Enable Mantras",labelMomo:"Momentum Mantras",labelPin:"Pin",labelUnpin:"Unpin",labelActivate:"Activate",minSuggestionsLength:3,panelid:"mantras",pinningMantra:!1,suggestionsEmpty:!1,template:i.templates.main,timeListAddSuggestion:350,timeOnboardFade:400,events:{scroll:"handleStickySubnav","click .subnav-titles .customs":"selectCustom","click .subnav-titles .favs":"selectFavs","click .subnav-titles .history":"selectHistory","click .list-add-button":"handleClickListAddButton","keyup .list-add-input":"handleKeyupListAdd","keypress .list-add-input":"handleKeypressListAdd","focus .list-add-input":"updateCharCountAdd","input .list-add-input":"updateCharCountAdd","click .suggestions-label":"showSuggestions","click .list-add-form .mantra-suggestion":"addMantraSuggestion","click .remove":"deleteMantraSuggestion","click .list-add-form .cancel":"cancelListAdd","click .empty-add-shortcut":"handleClickListAddButton","click .button-advanced":"toggleAdvanced","click .mantras-enabled":"handleClickMantrasEnabled","click .frequencies":"handleClickFrequencies","click .frequency":"handleClickFrequency","click .momo":"handleClickMomoFeed","click .custom":"handleClickCustomFeed","click .custom .feed-empty":"handleClickCustomFeedEmpty","click .hide-onboard":"handleClickHideOnboard"},initialize:function(){this.subViews=[],r.models.mantraSettingsManager||(r.models.mantraSettingsManager=new i.models.MantraSettingsManager),this.manager=r.models.mantraSettingsManager,this.collection=this.manager.initCustom(),this.favs=this.manager.initFavorites(),this.history=this.manager.initHistory(),this.plusUser=r.conditionalFeatures.featureEnabled("plus"),this.listenTo(this.favs,"reset",this.addAllFavs),this.listenTo(this.favs,"change",this.checkFavs),this.listenTo(this.history,"reset",this.addAllHistory),this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.onCollectionAdd),this.listenTo(this.collection,"update",this.handleCollectionUpdate),this.listenTo(this.manager,"change",this.handleManagerChange),this.listenTo(r.models.mantraManager,"change",this.handleManagerChange),this.listenTo(this.manager.settings,"change",this.handleManagerChange),this.listenTo(r.models.mantraManager,"mantra:deleted",this.updatePanel),this.listenTo(r.models.customization,"change:themeColour",this.onChangeThemeColour),this.listenTo(r.models.customization,"change:mantraVisible",this.onChangeMantraVisible),r.sendEvent(this.gaTitle,"Panel Opened")},render:function(){var t={advancedLabel:"Settings",description:"Simple phrases to build positive mental habits",inputLengthMaxHtml:this.inputLengthMaxHtml,labelAdd:this.labelAdd,labelCustom:this.labelCustom,labelEnable:this.labelEnable,labelMomo:this.labelMomo,title:"Mantras"};return this.$el.html(this.template(t)),this.setViewVars(),this.collection.loadedOnce?this.addAll():(this.$el.addClass("loading"),this.handleCollectionUpdate()),this.plusUser?this.collection.fetch({reset:!0}):(this.$momoToggler.addClass("fixed"),this.handleCollectionUpdate()),this.updatePanel(),this},setViewVars:function(){this.$mainContainer=this.$(".main-container"),this.$subnav=this.$(".settings-subnav"),this.$subnavTitleCustom=this.$(".subnav-titles .customs"),this.$subnavTitleFavs=this.$(".subnav-titles .favs"),this.$subnavTitleHistory=this.$(".subnav-titles .history"),this.$offState=this.$(".off-state"),this.$listWrapper=this.$(".list-wrapper"),this.$customWrapper=this.$(".custom-wrapper"),this.$listAddForm=this.$(".list-add-form"),this.$listAddInput=this.$(".list-add-input"),this.$listAddSuggestionsWrapper=this.$(".list-add-form .suggestions"),this.$listAddSuggestionsLabel=this.$(".suggestions-label"),this.$listAddSuggestions=this.$(".list-add-suggestions"),this.$suggestions=this.$(".suggestions"),this.$emptySuggestions=this.$(".empty-suggestions"),this.$customList=this.$(".custom-list"),this.$customEmpty=this.$(".custom-empty"),this.$favsWrapper=this.$(".favs-wrapper"),this.$favsList=this.$(".favs-list"),this.$favsEmpty=this.$(".favs-empty"),this.$historyWrapper=this.$(".history-wrapper"),this.$historyList=this.$(".history-list"),this.$historyEmpty=this.$(".history-empty"),this.$mantraToggler=this.$(".mantras-enabled"),this.$frequency=this.$(".frequency"),this.$momoToggler=this.$(".momo"),this.$customToggler=this.$(".custom"),this.$customFeedEmpty=this.$(".custom .feed-empty"),this.$feeds=this.$(".feeds"),this.$onboard=this.$(".settings-mantras-onboard")},onChangeMantraVisible:function(){this.updatePanel()},onChangeThemeColour:function(){handleStickySubnav(this)},handleStickySubnav:function(){this.$mainContainer.is(":visible")&&handleStickySubnav(this)},scrollToTopStickySubnav:function(){this.pinningMantra?this.pinningMantra=!1:scrollToTopStickySubnav(this)},handleManagerChange:function(t){"suggestionIndex"in t.changedAttributes()||this.updatePanel()},handleCollectionUpdate:function(){this.updatePanel(),r.models.mantraSettings.get("firstMantraActivated")?this.displayMain():this.displayOnboard()},updatePanel:function(){var t=r.models.customization.get("mantraVisible"),s=this.manager.isFeedActive("custom"),e=this.manager.isFeedActive("momo");this.$subnav.css("display",t?"flex":"none"),this.$listWrapper.mToggle("block",t),updateListAddFormBorder(this.$listAddForm,this.manager.customEmpty()),this.$offState.mToggle("block",!t),this.$mantraToggler.toggleClass("on",t).toggleClass("border-fix",!t&&!this.$feeds.is(":visible")),this.$momoToggler.toggleClass("on",e),this.$customFeedEmpty.mToggle("block",this.plusUser&&this.manager.customEmpty()),this.$customToggler.toggleClass("on",s),this.syncFrequency(r.models.mantraSettings.get("frequency")),t&&this.showActiveCollection(),r.models.mantraSettings.get("firstMantraActivated")&&this.displayMain()},showPlusUpsellNotif:function(t){var s={targetRegion:"settings",buttonText:"Learn more"};"custom"===t?(s.sourceEvent="customMantras",s.title=this.labelCustom,s.description="Add your own mantras"):"frequency"===t?(s.sourceEvent="mantraFrequency",s.title="Mantra Frequency",s.description="Change how often mantras display"):"pin"===t?(s.sourceEvent="mantraPin",s.title="Pin Mantras",s.description="Show a mantra for the entire day"):"activate"===t&&(s.sourceEvent="mantraPin",s.title="Switch Mantra",s.description="Change to any mantra you like"),r.commandManager.execute("upsell.message",s)},addAll:function(){this.$el.removeClass("loading");var s=this;_.each(this.subViews,function(t){t.destroy()}),this.subViews=[],this.$customList.html(""),this.collection.models.map(function(t){s.addOne(t,!1)}),this.syncPinnedMantra(this.$customList),this.syncActiveMantra(this.$customList),this.handleCollectionUpdate()},addOne:function(t,s){var e=new i.views.Mantra({model:t,main:this,customSubnav:!this.manager.get("showFavs"),isCustom:!0}),n=e.render().$el;this.subViews.push(e),this.$customList.prepend(n),s&&n.addClass("animate-item"),setTimeout(function(){n.removeClass("animate-item")},300)},onCollectionAdd:function(t){this.addOne(t,!0)},syncPinnedMantra:function(t){t.find(".mantra-item.pinned").removeClass("pinned").find(".control-pin").attr("title",this.labelPin).removeClass("active");var s=r.models.mantraManager.getPinnedMantra();s&&t.find("[data-mantra-id="+s.id+"]").addClass("pinned").find(".control-pin").attr("title",this.labelUnpin).addClass("active")},syncActiveMantra:function(t){var s;t.find(".mantra-item.active").removeClass("active").find(".control-activate").attr("title",this.labelActivate).removeClass("active");var e=r.models.mantraManager.getActiveItem();e&&(s=e.get("_id")),s&&t.find("[data-mantra-id="+s+"]").addClass("active").find(".control-activate").attr("title","Active").addClass("active")},syncFrequency:function(t){this.$frequency.removeClass("active"),this.$("#"+t).addClass("active")},toggleAdvanced:function(){toggleAdvanced(this)},handleClickMantrasEnabled:function(){r.models.mantraManager.toggleEnabled(this.plusUser),r.models.mantraManager.isEnabled()&&!this.$feeds.is(":visible")&&this.$feeds.css("display","block")},handleClickFrequency:function(t){if(t.stopPropagation(),this.plusUser){var s=d(t.currentTarget).attr("id");s!==r.models.mantraSettings.get("frequency")&&(this.manager.setFrequency(s),r.models.mantraManager.isEnabled()||this.handleClickMantrasEnabled())}else this.showPlusUpsellNotif("frequency")},handleClickFrequencies:function(t){t.stopPropagation(),this.plusUser?(this.manager.nextFrequency(),r.models.mantraManager.isEnabled()||this.handleClickMantrasEnabled()):this.showPlusUpsellNotif("frequency")},handleClickMomoFeed:function(){this.plusUser&&this.manager.toggleFeed("momo")},handleClickCustomFeed:function(){this.plusUser?this.manager.toggleFeed("custom"):this.showPlusUpsellNotif("custom")},handleClickCustomFeedEmpty:function(t){t.stopPropagation(),this.manager.get("showFavs")&&this.manager.set("showFavs",!1),r.models.mantraManager.isEnabled()||this.isFeedActive("custom")||this.isFeedActive("momo")||(r.models.mantraManager.toggleEnabled(),this.toggleFeed("custom")),this.toggleAdvanced();var s=this;setTimeout(function(){s.toggleListAddForm(!0)},100)},selectCustom:function(t){this.manager.get("showFavs")||this.manager.get("showHistory")?(this.manager.set("showFavs",!1),this.manager.set("showHistory",!1),handleStickySubnav(this),r.sendEvent(this.gaTitle,"Select Subnav","custom")):toggleClassTwice(d(t.currentTarget),"active")},selectFavs:function(t){this.manager.get("showFavs")?toggleClassTwice(d(t.currentTarget),"active"):(this.cancelListAdd(),this.manager.trigger("show-favs"),this.manager.set("showFavs",!0),this.manager.set("showHistory",!1),this.manager.favorites.loadedOnce||this.$el.addClass("loading"),this.manager.refreshFavorites(),handleStickySubnav(this),r.sendEvent(this.gaTitle,"Select Subnav","favorites"))},selectHistory:function(t){this.manager.get("showHistory")?toggleClassTwice(d(t.currentTarget),"active"):(this.cancelListAdd(),this.manager.trigger("show-history"),this.manager.set("showHistory",!0),this.manager.set("showFavs",!1),this.manager.history.loadedOnce||this.$el.addClass("loading"),this.manager.refreshHistory(),handleStickySubnav(this),r.sendEvent(this.gaTitle,"Select Subnav","history"))},showActiveCollection:function(){var t=this.manager.get("showFavs"),s=this.manager.get("showHistory"),e=!t&&!s;if(this.$customWrapper.mToggle("block",e),this.$favsWrapper.mToggle("block",t),this.$historyWrapper.mToggle("block",s),this.$subnavTitleCustom.toggleClass("active",e),this.$subnavTitleFavs.toggleClass("active",t),this.$subnavTitleHistory.toggleClass("active",s),t){this.addAllFavs();var n=0<this.manager.initFavorites().length;this.$favsList.mToggle("block",n),this.$favsEmpty.mToggle("block",!n)}else this.showCustomHelper();if(s){this.addAllHistory();var i=0<this.manager.initHistory().length;this.$historyList.toggle(i),this.$historyEmpty.toggle(!i)}else this.showCustomHelper();this.scrollToTopStickySubnav()},showCustomHelper:function(){var t=this.manager.customEmpty();if(this.$customList.mToggle("block",!t),this.$customEmpty.mToggle("block",t),this.deletingFinalItem)this.cancelListAdd(),this.deletingFinalItem=!1;else{var s=this;setTimeout(function(){s.syncPinnedMantra(s.$customList),s.syncActiveMantra(s.$customList)},0)}},checkFavs:function(){_.each(this.subViewsFavs,function(t){t.model.get("is_favorite")||t.hide()})},addAllFavs:function(){this.$favsList&&(this.manager.favorites.loadedOnce&&this.manager.get("showFavs")&&this.$el.removeClass("loading"),this.$favsList.empty(),_.each(this.subViewsFavs,function(t){t.destroy()}),this.subViewsFavs=[],this.addAllFavsHelper(this.manager.initFavorites()),this.syncPinnedMantra(this.$favsList),this.syncActiveMantra(this.$favsList))},addAllFavsHelper:function(t){var e=this;t.forEach(function(t){var s=new i.views.Mantra({model:t,main:e,isCustom:t.get("is_custom")});e.subViewsFavs.push(s),e.$favsList.append(s.render().$el)}),0<t.length&&(this.$favsList.css("display","block"),this.$favsEmpty.hide())},addAllHistory:function(){this.$historyList&&(this.manager.history.loadedOnce&&this.manager.get("showHistory")&&this.$el.removeClass("loading"),this.$historyList.empty(),_.each(this.subViewsHistory,function(t){t.destroy()}),this.subViewsHistory=[],this.addAllHistoryHelper(this.manager.initHistory()),this.syncPinnedMantra(this.$historyList),this.syncActiveMantra(this.$historyList))},addAllHistoryHelper:function(t){var e=this;t.forEach(function(t){var s=new i.views.Mantra({model:t,main:e,isCustom:t.get("is_custom")});e.subViewsHistory.push(s),e.$historyList.append(s.render().$el)}),0<t.length&&(this.$historyList.show(),this.$historyEmpty.hide())},handleClickListAddButton:function(){this.plusUser?this.toggleListAddForm():this.showPlusUpsellNotif("custom")},checkForFavsEmpty:function(){this.manager.get("showFavs")&&this.manager.favsEmpty()&&(this.$favsList.hide(),this.$favsEmpty.css("display","block"))},checkForHistoryEmpty:function(){this.manager.get("showHistory")&&this.manager.historyEmpty()&&(this.$historyList.hide(),this.$historyEmpty.show())},toggleListAddForm:function(t){this.manager.trigger("toggle-list-add-form"),(this.manager.get("showFavs")||this.manager.get("showHistory"))&&this.selectCustom(),this.$listAddForm.is(":visible")&&!t?(this.$listAddForm.hide(),this.manager.customEmpty()&&this.$customEmpty.css("display","block")):(this.scrollToTopStickySubnav(),this.checkForSuggestionsEmpty(),this.manager.customEmpty()&&this.$customEmpty.hide(),this.$listAddForm.css("display","block"),this.$listAddInput.trigger("focus")),handleStickySubnav(this)},resetListAdd:function(t,s,e){t.find("input").val(""),e||t.find("input").trigger("focus"),s.suggestionsEmpty||s.$listAddSuggestionsLabel.css("display","inline-block"),s.$listAddSuggestions.hide(),e||s.customFirstAddHelper(s)},handleKeyupListAdd:function(t){handleKeyupEsc(t,this.cancelListAdd.bind(this))},cancelListAdd:function(){this.$listAddForm.is(":visible")&&(this.resetListAdd(this.$listAddForm,this,!0),this.toggleListAddForm())},customFirstAddHelper:function(t){1===t.collection.length&&(t.manager.isFeedActive("custom")||this.toggleFeed("custom"),t.manager.isFeedActive("momo")||t.manager.trigger("mantra-custom-only-first-add"))},populateMantraSuggestion:function(t){var s=this;this.updateSuggestionsArray(),r.models.mantraManager.suggestedMantras.length<this.minSuggestionsLength?s.noMoreSuggestions():t.find(".mantra-suggestion").each(function(){d(this).text(r.models.mantraManager.suggestedMantras[s.manager.attributes.suggestionIndex]),s.manager.incrementSuggestionIndex(r.models.mantraManager.suggestedMantras.length)})},updateSuggestionsArray:function(t){var s=[];this.collection.models.forEach(function(t){s.push(t.attributes.body)}),t&&s.push(t.text()),r.models.mantraManager.suggestedMantras=r.models.mantraManager.suggestedMantras.filter(function(t){return s.indexOf(t)<0})},showSuggestions:function(){this.populateMantraSuggestion(this.$listAddForm),this.$listAddSuggestionsLabel.hide(),this.$listAddSuggestions.css("display","inline")},updateCharCountAdd:function(t){updateCharCount(t,this)},handleClickHideOnboard:function(){this.displayMain(),r.models.mantraManager.activateFirstMantra()},displayMain:function(){this.$onboard.hide(),this.$mainContainer.css("display","block")},displayOnboard:function(){this.$onboard.addClass("show"),this.$mainContainer.hide()},fillMantraSuggestion:function(t,s){var e,n=this.manager.get("suggestionIndex"),i=d(t.currentTarget),a=r.models.mantraManager.suggestedMantras[n],o=[],l=this;this.suggestionFillInProgress=!0,i.hasClass("remove")&&(e=i),i.hasClass("list-add")&&(e=i.next()),"remove"===s&&(i=i.prev()),"add"===s&&this.processAddForm(t,i,function(){l.$listAddInput.val("").trigger("focus"),l.customFirstAddHelper(l)}),this.updateSuggestionsArray(i),i.closest("form").find(".mantra-suggestion").each(function(){o.push(d(this).text())}),o.includes(a)&&r.models.mantraManager.suggestedMantras.forEach(function(t){o.includes(t)||(a=t)}),i.fadeTo(this.timeListAddSuggestion,0,function(){i.text(a)}).fadeTo(this.timeListAddSuggestion,1,function(){l.suggestionFillInProgress=!1}),e&&e.fadeTo(this.timeListAddSuggestion,0).fadeTo(this.timeListAddSuggestion,1),this.updateSuggestionsState()},addMantraSuggestion:function(t){this.suggestionFillInProgress||this.fillMantraSuggestion(t,"add")},deleteMantraSuggestion:function(t){this.suggestionFillInProgress||this.fillMantraSuggestion(t,"remove")},updateSuggestionsState:function(){r.models.mantraManager.suggestedMantras.length<this.minSuggestionsLength?this.noMoreSuggestions():this.manager.incrementSuggestionIndex(r.models.mantraManager.suggestedMantras.length)},noMoreSuggestions:function(){var t=this;this.$suggestions.find("span").hide(),this.$emptySuggestions.fadeIn(t.timeOnboardFade,function(){t.$listAddInput.trigger("focus")}).css("display","inline-block"),this.suggestionsEmpty=!0},checkForSuggestionsEmpty:function(){(this.suggestionsEmpty||this.allSuggestionsAdded())&&this.$listAddSuggestionsWrapper.hide()},allSuggestionsAdded:function(){return this.updateSuggestionsArray(),r.models.mantraManager.suggestedMantras.length<this.minSuggestionsLength},handleKeypressListAdd:function(t){this.handleKeypressAdd(t,this.$listAddForm,this.resetListAdd,this)},handleKeypressAdd:function(t,s,e,n){var i=d(t.currentTarget);13===t.keyCode?(t.preventDefault(),t.shiftKey||t.ctrlKey||t.metaKey||t.altKey||this.processAddForm(t,s,function(){e(s,n)},n)):checkForInputMaxLengthError(i)},processAddForm:function(t,s,e,n){var i;t&&t.preventDefault(),i=s.hasClass("mantra-suggestion")?s.text():s.find("input").val().trim(),i=r.utils.capitalizeFirstLetter(i),betweenInclusive(i.length,1,this.inputLengthMaxDatabase)?(this.collection.create({body:i,type:"mantra"},{wait:!0,success:e,error:function(){console.log("mantra add error")}}),r.sendEvent(this.gaTitle,"Add")):flashInputLengthError(s.find("input"))}}),r.commandManager&&r.commandManager.registerCommand("settings.panels.mantras",function(){return new i.views.Main}),i.styles.style(),r.trigger("settings:register:nav",{id:"mantra-settings",title:"Mantras",cmd:"settings.panels.mantras",position:17}),i};m.addinManager&&m.addinManager.registerAddinFn("dd91d97e-fc83-4fca-b5cb-d89eb2e1dd0f",fn_addin);